{"ast":null,"code":"import _toConsumableArray from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{GLOBALTYPES}from\"./globalTypes\";import{postDataAPI,getDataAPI}from\"../../utils/fetchData\";import{createNotify,removeNotify}from\"./notifyAction\";export var REQUEST_TYPES={LOADING:\"LOADING_REQUESTS\",CREATE_REQUEST:\"CREATE_REQUEST\",ACCEPT_REQUEST:\"ACCEPT_REQUEST\",REJECT_REQUEST:\"REJECT_REQUEST\",GET_SENT_REQUESTS:\"GET_SENT_REQUESTS\",GET_RECEIVED_REQUESTS:\"GET_RECEIVED_REQUESTS\",GET_MATCH_REQUEST:\"GET_MATCH_REQUEST\"};export var createRequest=function createRequest(_ref){var sender=_ref.sender,receiver=_ref.receiver,user=_ref.user,auth=_ref.auth,socket=_ref.socket;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!user.matches.every(function(item){return item._id!==receiver;})){_context.next=11;break;}_context.prev=1;_context.next=4;return postDataAPI(\"createrequest\",{sender:sender,receiver:receiver},auth.token);case 4:dispatch({type:REQUEST_TYPES.CREATE_REQUEST});socket.emit(\"requestmatch\",receiver);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context.t0.response.data.msg}});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function(_x){return _ref2.apply(this,arguments);};}();};export var getSentMatchRequests=function getSentMatchRequests(_ref3){var auth=_ref3.auth;return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var res,newArr;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return getDataAPI(\"sentrequests\",auth.token);case 3:res=_context2.sent;newArr=res.data.matchRequests;dispatch({type:REQUEST_TYPES.GET_SENT_REQUESTS,payload:{newArr:newArr,result:res.data.result}});_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context2.t0.response.data.msg}});case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function(_x2){return _ref4.apply(this,arguments);};}();};export var getReceivedMatchRequests=function getReceivedMatchRequests(_ref5){var auth=_ref5.auth;return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var res,newArr;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return getDataAPI(\"receivedrequests\",auth.token);case 3:res=_context3.sent;newArr=res.data.matchRequests;dispatch({type:REQUEST_TYPES.GET_RECEIVED_REQUESTS,payload:{newArr:newArr,result:res.data.result}});_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context3.t0.response.data.msg}});case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function(_x3){return _ref6.apply(this,arguments);};}();};export var acceptMatchRequest=function acceptMatchRequest(_ref7){var auth=_ref7.auth,socket=_ref7.socket,sender=_ref7.sender,receiver=_ref7.receiver;return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var res,msg;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// if (users.every((item) => item._id !== user._id)) {\n//   newUser = { ...user, matches: [...user.matches, auth.user] };\n// } else {\n//   users.forEach((item) => {\n//     if (item._id === user._id) {\n//       newUser = { ...item, matches: [...item.matches, auth.user] };\n//     }\n//   });\n// }\ndispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:_objectSpread(_objectSpread({},auth.user),{},{matches:[].concat(_toConsumableArray(auth.user.matches),[sender])})})});_context4.prev=1;_context4.next=4;return postDataAPI(\"/acceptrequest\",{sender:sender,receiver:receiver},auth.token);case 4:res=_context4.sent;// todo socket\nsocket.emit(\"makematch\",sender,receiver);// todo notification\nmsg={id:auth.user._id,text:\"is now a match with you\",recipients:[sender],url:\"/profile/\".concat(auth.user._id)};dispatch(createNotify({msg:msg,auth:auth,socket:socket}));_context4.next=13;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](1);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context4.t0.response.data.msg}});case 13:case\"end\":return _context4.stop();}}},_callee4,null,[[1,10]]);}));return function(_x4){return _ref8.apply(this,arguments);};}();};export var rejectMatchRequest=function rejectMatchRequest(_ref9){var sender=_ref9.sender,receiver=_ref9.receiver,auth=_ref9.auth,socket=_ref9.socket;return/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch){var res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return postDataAPI(\"/rejectrequest\",{sender:sender,receiver:receiver},auth.token);case 3:res=_context5.sent;socket.emit(\"rejectmatch\",sender,receiver);_context5.next=10;break;case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context5.t0.response.data.msg}});case 10:case\"end\":return _context5.stop();}}},_callee5,null,[[0,7]]);}));return function(_x5){return _ref10.apply(this,arguments);};}();};","map":{"version":3,"sources":["C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/src/redux/actions/matchRequestAction.js"],"names":["GLOBALTYPES","postDataAPI","getDataAPI","createNotify","removeNotify","REQUEST_TYPES","LOADING","CREATE_REQUEST","ACCEPT_REQUEST","REJECT_REQUEST","GET_SENT_REQUESTS","GET_RECEIVED_REQUESTS","GET_MATCH_REQUEST","createRequest","sender","receiver","user","auth","socket","dispatch","matches","every","item","_id","token","type","emit","ALERT","payload","error","response","data","msg","getSentMatchRequests","res","newArr","matchRequests","result","getReceivedMatchRequests","acceptMatchRequest","AUTH","id","text","recipients","url","rejectMatchRequest"],"mappings":"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","sourcesContent":["import { GLOBALTYPES } from \"./globalTypes\";\r\nimport { postDataAPI, getDataAPI } from \"../../utils/fetchData\";\r\nimport { createNotify, removeNotify } from \"./notifyAction\";\r\n\r\nexport const REQUEST_TYPES = {\r\n  LOADING: \"LOADING_REQUESTS\",\r\n  CREATE_REQUEST: \"CREATE_REQUEST\",\r\n  ACCEPT_REQUEST: \"ACCEPT_REQUEST\",\r\n  REJECT_REQUEST: \"REJECT_REQUEST\",\r\n  GET_SENT_REQUESTS: \"GET_SENT_REQUESTS\",\r\n  GET_RECEIVED_REQUESTS: \"GET_RECEIVED_REQUESTS\",\r\n  GET_MATCH_REQUEST: \"GET_MATCH_REQUEST\",\r\n};\r\n\r\nexport const createRequest =\r\n  ({ sender, receiver, user, auth, socket }) =>\r\n  async (dispatch) => {\r\n    if (user.matches.every((item) => item._id !== receiver)) {\r\n      try {\r\n          await postDataAPI(\"createrequest\", { sender, receiver }, auth.token);\r\n          dispatch({\r\n            type: REQUEST_TYPES.CREATE_REQUEST,\r\n          });\r\n          socket.emit(\"requestmatch\", receiver);\r\n      } catch (err) {\r\n        dispatch({\r\n          type: GLOBALTYPES.ALERT,\r\n          payload: { error: err.response.data.msg },\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\nexport const getSentMatchRequests =\r\n  ({ auth}) =>\r\n  async (dispatch) => {\r\n    try {\r\n      const res = await getDataAPI(\r\n        `sentrequests`,\r\n        auth.token\r\n      );\r\n      let newArr = res.data.matchRequests;\r\n      dispatch({\r\n        type: REQUEST_TYPES.GET_SENT_REQUESTS,\r\n        payload: { newArr, result: res.data.result },\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n\r\nexport const getReceivedMatchRequests =\r\n  ({ auth}) =>\r\n  async (dispatch) => {\r\n    try {\r\n      const res = await getDataAPI(\r\n        `receivedrequests`,\r\n        auth.token\r\n      );\r\n      let newArr = res.data.matchRequests;\r\n      dispatch({\r\n        type: REQUEST_TYPES.GET_RECEIVED_REQUESTS,\r\n        payload: { newArr, result: res.data.result },\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n\r\nexport const acceptMatchRequest =\r\n  ({ auth, socket, sender, receiver }) =>\r\n  async (dispatch) => {\r\n    // if (users.every((item) => item._id !== user._id)) {\r\n    //   newUser = { ...user, matches: [...user.matches, auth.user] };\r\n    // } else {\r\n    //   users.forEach((item) => {\r\n    //     if (item._id === user._id) {\r\n    //       newUser = { ...item, matches: [...item.matches, auth.user] };\r\n    //     }\r\n    //   });\r\n    // }\r\n\r\n    dispatch({\r\n      type: GLOBALTYPES.AUTH,\r\n      payload: {\r\n        ...auth,\r\n        user: { ...auth.user, matches: [...auth.user.matches, sender] },\r\n      },\r\n    });\r\n\r\n    try {\r\n      const res = await postDataAPI(\r\n        `/acceptrequest`,\r\n        {sender, receiver},\r\n        auth.token\r\n      );\r\n      // todo socket\r\n      socket.emit(\"makematch\", sender, receiver);\r\n\r\n      // todo notification\r\n      const msg = {\r\n        id: auth.user._id,\r\n        text: \"is now a match with you\",\r\n        recipients: [sender],\r\n        url: `/profile/${auth.user._id}`,\r\n      };\r\n\r\n      dispatch(createNotify({ msg, auth, socket }));\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n\r\nexport const rejectMatchRequest =\r\n  ({ sender, receiver, auth, socket }) =>\r\n  async (dispatch) => {\r\n    try {\r\n      const res = await postDataAPI(`/rejectrequest`, { sender, receiver }, auth.token);\r\n      socket.emit(\"rejectmatch\", sender, receiver);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };"]},"metadata":{},"sourceType":"module"}