{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from\"react\";// import UserCard from \"../UserCard\";\nimport AnanomUserCard from\"./AnanomUserCard\";import{useDispatch,useSelector}from\"react-redux\";import{useParams}from\"react-router-dom\";import{ToastContainer,toast}from\"react-toastify\";import MsgDisplay from\"../message/MsgDisplay\";import AnanomMsgDisplay from\"./AnanomMsgDisplay\";import Icons from\"../Icons\";import{GLOBALTYPES}from\"../../redux/actions/globalTypes\";import{imageShow,videoShow}from\"../../utils/mediaShow\";import{imageUpload}from\"../../utils/imageUpload\";import EndChatModel from\"./EndChatModel\";import{addMessage,getMessages,MESSAGE_TYPES}from\"../../redux/actions/saveConversation\";// import {\n//   addMessage,\n//   getMessages,\n//   MESSAGE_TYPES,\n// } from \"../../redux/actions/messageAction\";\nimport LoadIcon from\"../../images/loading.gif\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AnanomUserChat=function AnanomUserChat(props){console.log(props);var googleId=props.receiverGoogleId;var ananomConversation=props.ananomConversation;var receieverSocketID=props.receieverSocketID;var id=props.id;var ownID=props.ownId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,message=_useSelector.message,theme=_useSelector.theme,socket=_useSelector.socket;var dispatch=useDispatch();var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),incomingMessage=_useState4[0],setIncomingMessage=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),text=_useState6[0],setText=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),page=_useState8[0],setPage=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),onEdit=_useState10[0],setOnEdit=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),media=_useState12[0],setMedia=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),loadMedia=_useState14[0],setLoadMedia=_useState14[1];var refDisplay=useRef();var pageEnd=useRef();useEffect(function(){socket.on(\"getAnanomMessage\",function(data){console.log(data);setIncomingMessage({sender:data.sender,receiverId:auth.user._id,text:data.text,media:data.media,createdAt:data.createdAt});});},[socket]);console.log(incomingMessage);useEffect(function(){var addmessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!incomingMessage){_context.next=4;break;}setMessages(function(prev){return[].concat(_toConsumableArray(prev),[incomingMessage]);});_context.next=4;return dispatch(addMessage({message:incomingMessage}));case 4:case\"end\":return _context.stop();}}},_callee);}));return function addmessage(){return _ref.apply(this,arguments);};}();addmessage();},[incomingMessage]);var handleChangeMedia=function handleChangeMedia(e){var files=_toConsumableArray(e.target.files);var err=\"\";var newMedia=[];files.forEach(function(file){if(!file){return err=\"File does not exist.\";}if(file.size>1024*1024*5){return err=\"Image size must be less than 5 mb.\";}return newMedia.push(file);});if(err){dispatch({type:GLOBALTYPES.ALERT,payload:{error:err}});}setMedia([].concat(_toConsumableArray(media),newMedia));};var handleDeleteMedia=function handleDeleteMedia(index){var newArr=_toConsumableArray(media);newArr.splice(index,1);setMedia(newArr);};var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var newArr,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!(!text.trim()&&media.length===0)){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:setText(\"\");setMedia([]);setLoadMedia(true);newArr=[];if(!(media.length>0)){_context2.next=11;break;}_context2.next=10;return imageUpload(media);case 10:newArr=_context2.sent;case 11:message={sender:auth.user._id,receiverId:googleId,text:text,media:newArr,createdAt:new Date().toISOString()};console.log(ananomConversation);console.log(ownID);// ananomConversation?.members?.includes(ownID) &&\nsetMessages(function(prev){return[].concat(_toConsumableArray(prev),[message]);});socket.emit(\"sendAnanomMessage\",message);setLoadMedia(false);_context2.next=19;return dispatch(addMessage({message:message}));case 19:if(refDisplay.current){refDisplay.current.scrollIntoView({behaviour:\"smooth\",block:\"end\"});}case 20:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){if(refDisplay.current){refDisplay.current.scrollIntoView({behaviour:\"smooth\",block:\"end\"});}},[text]);useEffect(function(){if(incomingMessage){refDisplay.current.scrollIntoView({behaviour:\"smooth\",block:\"end\"});}},[incomingMessage]);console.log(googleId);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"message_header\",children:/*#__PURE__*/_jsx(AnanomUserCard,{find:props.find,setFind:props.setFind,end:props.end,setEnd:props.setEnd,bcode:props.bcode,setBcode:props.setBcode,receiver:googleId,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash text-danger\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat_container\",style:{height:\"calc(100% - 180px)\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat_display\",ref:refDisplay,children:[/*#__PURE__*/_jsx(\"button\",{style:{marginTop:\"-25px\",opacity:0},ref:pageEnd,children:\"Load..\"}),messages.map(function(msg,index){return/*#__PURE__*/_jsxs(\"div\",{children:[msg.sender!==auth.user._id&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row other_message\",children:/*#__PURE__*/_jsx(AnanomMsgDisplay,{msg:msg,theme:theme})}),msg.sender===auth.user._id&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row you_message\",children:/*#__PURE__*/_jsx(MsgDisplay,{user:auth.user,msg:msg,theme:theme})})]},index);}),loadMedia&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row you_message\",children:/*#__PURE__*/_jsx(\"img\",{src:LoadIcon,alt:\"Loading...\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"show_media\",style:{display:media.length>0?\"\":\"none\"},children:media.map(function(item,index){return/*#__PURE__*/_jsxs(\"div\",{id:\"file_media\",children:[item.type.match(/video/i)?videoShow(URL.createObjectURL(item),theme):imageShow(URL.createObjectURL(item),theme),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return handleDeleteMedia(index);},children:\"\\xD7\"})]},index);})}),/*#__PURE__*/_jsxs(\"form\",{className:\"chat_input\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Type a message.\",type:\"text\",value:text,onChange:function onChange(e){return setText(e.target.value);},style:{filter:theme?\"invert(1)\":\"invert(0)\",background:theme?\"#040404\":\"\",color:theme?\"white\":\"\"}}),/*#__PURE__*/_jsx(Icons,{setContent:setText,content:text,theme:theme}),/*#__PURE__*/_jsxs(\"div\",{className:\"file_upload\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-image color-c1\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"file\",id:\"file\",multiple:true,accept:\"image/*,video/*\",onChange:handleChangeMedia})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:text||media.length>0?false:true,className:\"material-icons\",children:\"near_me\"})]}),onEdit&&/*#__PURE__*/_jsx(EndChatModel,{setOnEdit:setOnEdit,receiver:props.receiver})]});};export default AnanomUserChat;","map":{"version":3,"sources":["C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/src/components/AnanomousUser/AnanomUserChat.js"],"names":["React","useEffect","useState","useRef","AnanomUserCard","useDispatch","useSelector","useParams","ToastContainer","toast","MsgDisplay","AnanomMsgDisplay","Icons","GLOBALTYPES","imageShow","videoShow","imageUpload","EndChatModel","addMessage","getMessages","MESSAGE_TYPES","LoadIcon","AnanomUserChat","props","console","log","googleId","receiverGoogleId","ananomConversation","receieverSocketID","id","ownID","ownId","messages","setMessages","state","auth","message","theme","socket","dispatch","incomingMessage","setIncomingMessage","text","setText","page","setPage","onEdit","setOnEdit","media","setMedia","loadMedia","setLoadMedia","refDisplay","pageEnd","on","data","sender","receiverId","user","_id","createdAt","addmessage","prev","handleChangeMedia","e","files","target","err","newMedia","forEach","file","size","push","type","ALERT","payload","error","handleDeleteMedia","index","newArr","splice","handleSubmit","preventDefault","trim","length","Date","toISOString","emit","current","scrollIntoView","behaviour","block","find","setFind","end","setEnd","bcode","setBcode","height","marginTop","opacity","map","msg","display","item","match","URL","createObjectURL","value","filter","background","color","receiver"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\n// import UserCard from \"../UserCard\";\r\nimport AnanomUserCard from \"./AnanomUserCard\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { ToastContainer, toast } from \"react-toastify\";\r\nimport MsgDisplay from \"../message/MsgDisplay\";\r\nimport AnanomMsgDisplay from \"./AnanomMsgDisplay\";\r\nimport Icons from \"../Icons\";\r\nimport { GLOBALTYPES } from \"../../redux/actions/globalTypes\";\r\nimport { imageShow, videoShow } from \"../../utils/mediaShow\";\r\nimport { imageUpload } from \"../../utils/imageUpload\";\r\nimport EndChatModel from \"./EndChatModel\";\r\nimport {\r\n  addMessage,\r\n  getMessages,\r\n  MESSAGE_TYPES,\r\n} from \"../../redux/actions/saveConversation\";\r\n\r\n// import {\r\n//   addMessage,\r\n//   getMessages,\r\n//   MESSAGE_TYPES,\r\n// } from \"../../redux/actions/messageAction\";\r\nimport LoadIcon from \"../../images/loading.gif\";\r\n\r\nconst AnanomUserChat = (props) => {\r\n  console.log(props);\r\n  const googleId = props.receiverGoogleId;\r\n  const ananomConversation = props.ananomConversation;\r\n  const receieverSocketID = props.receieverSocketID;\r\n  const id = props.id;\r\n  const ownID = props.ownId;\r\n  const [messages, setMessages] = useState([]);\r\n  const { auth, message, theme, socket } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n  const [incomingMessage, setIncomingMessage] = useState(null);\r\n  const [text, setText] = useState(\"\");\r\n  const [page, setPage] = useState(0);\r\n  const [onEdit, setOnEdit] = useState(false);\r\n  const [media, setMedia] = useState([]);\r\n  const [loadMedia, setLoadMedia] = useState(false);\r\n\r\n  const refDisplay = useRef();\r\n  const pageEnd = useRef();\r\n\r\n  useEffect(() => {\r\n    socket.on(\"getAnanomMessage\", (data) => {\r\n      console.log(data);\r\n      setIncomingMessage({\r\n        sender: data.sender,\r\n        receiverId: auth.user._id,\r\n        text: data.text,\r\n        media: data.media,\r\n        createdAt: data.createdAt,\r\n      });\r\n    });\r\n  }, [socket]);\r\n\r\n  console.log(incomingMessage);\r\n\r\n  useEffect(() => {\r\n    const addmessage = async () => {\r\n      if (incomingMessage) {\r\n        setMessages((prev) => [...prev, incomingMessage]);\r\n        await dispatch(addMessage({ message:incomingMessage }));\r\n      }\r\n    };\r\n    addmessage();\r\n  }, [incomingMessage]);\r\n\r\n  const handleChangeMedia = (e) => {\r\n    const files = [...e.target.files];\r\n    let err = \"\";\r\n    let newMedia = [];\r\n\r\n    files.forEach((file) => {\r\n      if (!file) {\r\n        return (err = \"File does not exist.\");\r\n      }\r\n      if (file.size > 1024 * 1024 * 5) {\r\n        return (err = \"Image size must be less than 5 mb.\");\r\n      }\r\n      return newMedia.push(file);\r\n    });\r\n    if (err) {\r\n      dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err } });\r\n    }\r\n    setMedia([...media, ...newMedia]);\r\n  };\r\n\r\n  const handleDeleteMedia = (index) => {\r\n    const newArr = [...media];\r\n    newArr.splice(index, 1);\r\n    setMedia(newArr);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!text.trim() && media.length === 0) return;\r\n    setText(\"\");\r\n    setMedia([]);\r\n\r\n    setLoadMedia(true);\r\n\r\n    let newArr = [];\r\n    if (media.length > 0) newArr = await imageUpload(media);\r\n\r\n    let message = {\r\n      sender: auth.user._id,\r\n      receiverId: googleId,\r\n      text,\r\n      media: newArr,\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n    console.log(ananomConversation);\r\n    console.log(ownID);\r\n    // ananomConversation?.members?.includes(ownID) &&\r\n    setMessages((prev) => [...prev, message]);\r\n    socket.emit(\"sendAnanomMessage\", message);\r\n    setLoadMedia(false);\r\n    await dispatch(addMessage({ message}));\r\n    if (refDisplay.current) {\r\n      refDisplay.current.scrollIntoView({\r\n        behaviour: \"smooth\",\r\n        block: \"end\",\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (refDisplay.current) {\r\n      refDisplay.current.scrollIntoView({\r\n        behaviour: \"smooth\",\r\n        block: \"end\",\r\n      });\r\n    }\r\n  }, [text]);\r\n\r\n  useEffect(() => {\r\n    if (incomingMessage) {\r\n      refDisplay.current.scrollIntoView({\r\n        behaviour: \"smooth\",\r\n        block: \"end\",\r\n      });\r\n    }\r\n  }, [incomingMessage]);\r\n\r\n  console.log(googleId);\r\n  return (\r\n    <>\r\n      <div className=\"message_header\">\r\n        {/* {user.length !== 0 && ( */}\r\n        <AnanomUserCard\r\n          find={props.find}\r\n          setFind={props.setFind}\r\n          end={props.end}\r\n          setEnd={props.setEnd}\r\n          bcode={props.bcode}\r\n          setBcode={props.setBcode}\r\n          receiver={googleId}\r\n        >\r\n          <i className=\"fas fa-trash text-danger\" />\r\n        </AnanomUserCard>\r\n        {/* )} */}\r\n      </div>\r\n\r\n      <div className=\"chat_container\" style={{ height: \"calc(100% - 180px)\" }}>\r\n        <div className=\"chat_display\" ref={refDisplay}>\r\n          <button style={{ marginTop: \"-25px\", opacity: 0 }} ref={pageEnd}>\r\n            Load..\r\n          </button>\r\n\r\n          {messages.map((msg, index) => (\r\n            <div key={index}>\r\n              {msg.sender !== auth.user._id && (\r\n                <div className=\"chat_row other_message\">\r\n                  <AnanomMsgDisplay msg={msg} theme={theme} />\r\n                </div>\r\n              )}\r\n              {msg.sender === auth.user._id && (\r\n                <div className=\"chat_row you_message\">\r\n                  <MsgDisplay user={auth.user} msg={msg} theme={theme} />\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))}\r\n          {loadMedia && (\r\n            <div className=\"chat_row you_message\">\r\n              <img src={LoadIcon} alt=\"Loading...\" />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div\r\n        className=\"show_media\"\r\n        style={{ display: media.length > 0 ? \"\" : \"none\" }}\r\n      >\r\n        {media.map((item, index) => (\r\n          <div key={index} id=\"file_media\">\r\n            {item.type.match(/video/i)\r\n              ? videoShow(URL.createObjectURL(item), theme)\r\n              : imageShow(URL.createObjectURL(item), theme)}\r\n            <span onClick={() => handleDeleteMedia(index)}>&times;</span>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <form className=\"chat_input\" onSubmit={handleSubmit}>\r\n        <input\r\n          placeholder=\"Type a message.\"\r\n          type=\"text\"\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          style={{\r\n            filter: theme ? \"invert(1)\" : \"invert(0)\",\r\n            background: theme ? \"#040404\" : \"\",\r\n            color: theme ? \"white\" : \"\",\r\n          }}\r\n        />\r\n        <Icons setContent={setText} content={text} theme={theme} />\r\n        <div className=\"file_upload\">\r\n          <i className=\"fas fa-image color-c1\" />\r\n          <input\r\n            type=\"file\"\r\n            name=\"file\"\r\n            id=\"file\"\r\n            multiple\r\n            accept=\"image/*,video/*\"\r\n            onChange={handleChangeMedia}\r\n          />\r\n        </div>\r\n        <button\r\n          type=\"submit\"\r\n          disabled={text || media.length > 0 ? false : true}\r\n          className=\"material-icons\"\r\n        >\r\n          near_me\r\n        </button>\r\n      </form>\r\n\r\n      {onEdit && (\r\n        <EndChatModel setOnEdit={setOnEdit} receiver={props.receiver} />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AnanomUserChat;\r\n"]},"metadata":{},"sourceType":"module"}