{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import{Box,makeStyles,Typography,Divider}from\"@material-ui/core\";// import { Stack } from \"@mui/material\";\nimport{useContext,useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{ToastContainer,toast}from\"react-toastify\";// import AnanomousChat from \"./AnanomousChat\";\nimport AnanomousUserChat from\"../../components/AnanomousUser/AnanomUserChat\";import FindButton from\"../../components/AnanomousUser/FindButton\";import{postDataAPI,getDataAPI}from\"../../utils/fetchData\";import{getMessages,getConversations}from\"../../redux/actions/saveConversation\";// import EndChatModel from \"../../components/AnanomousUser/EndChatModel\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyle=makeStyles(function(theme){return{component:{background:\"#f8f9fa\",textAlign:\"center\"},container:_defineProperty({padding:\"0 0\"},theme.breakpoints.down(\"sm\"),{padding:-0}),divider:{margin:\"30px 0\"}};});var Ananommessage=function Ananommessage(){// var ENDPOINT = \"http://localhost:3000/ananommessage\";\n// var PAGELOCATION = window.location.href;\nvar dispatch=useDispatch();// if (process.env.NODE_ENV === \"production\") {\n//   ENDPOINT = \"https://nameless-bayou-10689.herokuapp.com/\";\n// } else {\n//   ENDPOINT = \"http://localhost:3000/ananommessage\";\n// }\nvar _useState=useState(),_useState2=_slicedToArray(_useState,2),id=_useState2[0],setId=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),ownId=_useState4[0],setOwnId=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),googleId=_useState6[0],setGoogleId=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),messages=_useState8[0],setMessages=_useState8[1];var _useState9=useState(\"Click on Start Button to start the anonomous conversation\"),_useState10=_slicedToArray(_useState9,2),waitMessage=_useState10[0],setWaitMessage=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),code=_useState12[0],setCode=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),bcode=_useState14[0],setBcode=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),ananomConversation=_useState16[0],setAnanomConversation=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),runSaveConversation=_useState18[0],setRunSaveConversation=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),end=_useState20[0],setEnd=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),find=_useState22[0],setFind=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),typing=_useState24[0],setTyping=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),b=_useState26[0],setB=_useState26[1];// const [onEdit, setOnEdit] = useState(false);\n//   const { auth.user, socket, isAnanomUser } = useContext(auth.userContext);\nvar _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,theme=_useSelector.theme,socket=_useSelector.socket,ananomMessages=_useSelector.ananomMessages;var reduxData=useSelector(function(state){return state;});console.log(reduxData);console.log();var classes=useStyle();useEffect(function(){// window.addEventListener(\"beforeunload\", alertUser);\nwindow.addEventListener(\"unload\",handleEndConcert);return function(){// window.removeEventListener(\"beforeunload\", alertUser);\nwindow.removeEventListener(\"unload\",handleEndConcert);handleEndConcert();};},[]);var alertUser=function alertUser(e){e.preventDefault();var message=\"Are you sure you want to leave? All provided data will be lost.\";e.returnValue=message;return message;};var handleEndConcert=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:socket.emit(\"disconn\");case 1:case\"end\":return _context.stop();}}},_callee);}));return function handleEndConcert(){return _ref.apply(this,arguments);};}();useEffect(function(){if(ananomMessages.data.length>0){setMessages(ananomMessages.data);}},[ananomMessages.data]);useEffect(function(){var saveConveration=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(ananomMessages);_context2.next=3;return postDataAPI(\"create_ananomconversation\",{messages:messages},auth.token);case 3:res=_context2.sent;setRunSaveConversation(false);setMessages([]);dispatch(getMessages());dispatch(getConversations({auth:auth}));console.log(res);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function saveConveration(){return _ref2.apply(this,arguments);};}();runSaveConversation&&saveConveration();},[runSaveConversation]);useEffect(function(){console.log(socket);socket.on(\"conn\",function(data){console.log(data);setId(data.id);setOwnId(data.ownId);setGoogleId(data.googleId);setWaitMessage(data.text);// setMessages([]);\nsetCode(data.code);setBcode(data.bcode);});socket.on(\"waiting\",function(text){setWaitMessage(text.text);setCode(text.code);setBcode(text.bcode);});socket.on(\"disconn\",function(data){// console.log(data.id);\n// console.log(data.text);\nsetCode(data.code);setBcode(data.bcode);setWaitMessage(data.text);if(messages.length>0){setRunSaveConversation(true);}// console.log(code);\n});},[socket,end]);//todo\n// useEffect(() => {\n//   if (!isAnanomUser) {\n//     setEnd(true);\n//   }\n// }, [isAnanomUser]);\nuseEffect(function(){if(end===true){socket.emit(\"disconn\");setEnd(false);}},[end,socket]);useEffect(function(){if(waitMessage===\"Stranger has left the chat\"){if(messages.length>0){setRunSaveConversation(true);}}},[waitMessage]);useEffect(function(){socket.on(\"istyping\",function(isTyping){setB(isTyping);});});useEffect(function(){socket.emit(\"typing\",typing);});useEffect(function(){if(find===true){console.log(\"trying to find\");socket.emit(\"new\",auth.user.gender,auth.user._id);setFind(false);}},[find,socket]);useEffect(function(){toast(waitMessage);},[waitMessage]);// useEffect(() => {\n//   const ananomId = \"6209378269425237042ee680\";\n//   const useless = async () => {\n//     const res = await getDataAPI(`user/${ananomId}`, auth.token);\n//     console.log(res);\n//   };\n//   useless();\n// }, []);\n// useEffect(() => {\n//   // console.log(auth.user.googleId);\n//   // console.log(googleId);\n//   if (auth.user._id != null && googleId != null && ownId != null) {\n//     // console.log(ownId);\n//     setAnanomConversation({\n//       senderId: ownId,\n//       receiverId: id,\n//     });\n//   }\n// }, [auth.user._id, ownId, googleId, socket]);\nreturn/*#__PURE__*/_jsxs(Box,{className:classes.component,children:[/*#__PURE__*/_jsx(ToastContainer,{}),waitMessage===\"You are now chatting with a Stranger!\"?/*#__PURE__*/_jsx(AnanomousUserChat,{id:id,ownId:ownId,receiverId:id,receiverSocketId:id,receiverGoogleId:googleId,waitMessage:waitMessage,ananomConversation:ananomConversation,find:find,setFind:setFind,end:end,setEnd:setEnd,bcode:bcode,setBcode:setBcode}):/*#__PURE__*/_jsx(\"div\",{className:\"message d-flex\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-12 px-0\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center align-items-center flex-column h-100\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-bolt color-c1\",style:{fontSize:\"5rem\"}}),/*#__PURE__*/_jsx(\"h4\",{children:/*#__PURE__*/_jsx(FindButton,{find:find,setFind:setFind,end:end,setEnd:setEnd,bcode:bcode,setBcode:setBcode})})]})})})]});};export default Ananommessage;","map":{"version":3,"sources":["C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/src/pages/ananommessage/index.js"],"names":["Box","makeStyles","Typography","Divider","useContext","useEffect","useState","useDispatch","useSelector","ToastContainer","toast","AnanomousUserChat","FindButton","postDataAPI","getDataAPI","getMessages","getConversations","useStyle","theme","component","background","textAlign","container","padding","breakpoints","down","divider","margin","Ananommessage","dispatch","id","setId","ownId","setOwnId","googleId","setGoogleId","messages","setMessages","waitMessage","setWaitMessage","code","setCode","bcode","setBcode","ananomConversation","setAnanomConversation","runSaveConversation","setRunSaveConversation","end","setEnd","find","setFind","typing","setTyping","b","setB","state","auth","socket","ananomMessages","reduxData","console","log","classes","window","addEventListener","handleEndConcert","removeEventListener","alertUser","e","preventDefault","message","returnValue","emit","data","length","saveConveration","token","res","on","text","isTyping","user","gender","_id","fontSize"],"mappings":"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","sourcesContent":["import { Box, makeStyles, Typography, Divider } from \"@material-ui/core\";\r\n// import { Stack } from \"@mui/material\";\r\n\r\nimport { useContext, useEffect, useState } from \"react\";\r\nimport { useDispatch,useSelector } from \"react-redux\";\r\nimport { ToastContainer, toast } from \"react-toastify\";\r\n// import AnanomousChat from \"./AnanomousChat\";\r\nimport AnanomousUserChat from \"../../components/AnanomousUser/AnanomUserChat\";\r\nimport FindButton from \"../../components/AnanomousUser/FindButton\";\r\nimport {  postDataAPI, getDataAPI } from \"../../utils/fetchData\";\r\nimport {\r\n  getMessages,\r\n  getConversations,\r\n} from \"../../redux/actions/saveConversation\";\r\n\r\n\r\n// import EndChatModel from \"../../components/AnanomousUser/EndChatModel\";\r\n\r\nconst useStyle = makeStyles((theme) => ({\r\n  component: {\r\n    background: \"#f8f9fa\",\r\n    textAlign: \"center\",\r\n  },\r\n  container: {\r\n    padding: \"0 0\",\r\n    [theme.breakpoints.down(\"sm\")]: {\r\n      padding: -0,\r\n    },\r\n  },\r\n  divider: {\r\n    margin: \"30px 0\",\r\n  },\r\n}));\r\n\r\nconst Ananommessage = () => {\r\n  // var ENDPOINT = \"http://localhost:3000/ananommessage\";\r\n  // var PAGELOCATION = window.location.href;\r\n      const dispatch = useDispatch();\r\n\r\n  // if (process.env.NODE_ENV === \"production\") {\r\n  //   ENDPOINT = \"https://nameless-bayou-10689.herokuapp.com/\";\r\n  // } else {\r\n  //   ENDPOINT = \"http://localhost:3000/ananommessage\";\r\n  // }\r\n\r\n  const [id, setId] = useState();\r\n  const [ownId, setOwnId] = useState();\r\n\r\n  const [googleId, setGoogleId] = useState();\r\n  const [messages, setMessages] = useState([]);\r\n  const [waitMessage, setWaitMessage] = useState(\r\n    \"Click on Start Button to start the anonomous conversation\"\r\n  );\r\n  const [code, setCode] = useState(null);\r\n  const [bcode, setBcode] = useState(null);\r\n  const [ananomConversation, setAnanomConversation] = useState(null);\r\n  const [runSaveConversation, setRunSaveConversation] = useState(false)\r\n\r\n  const [end, setEnd] = useState(false);\r\n  const [find, setFind] = useState(false);\r\n  const [typing, setTyping] = useState(false);\r\n  const [b, setB] = useState(false);\r\n      // const [onEdit, setOnEdit] = useState(false);\r\n\r\n  //   const { auth.user, socket, isAnanomUser } = useContext(auth.userContext);\r\n  const { auth, theme, socket, ananomMessages } = useSelector((state) => state);\r\n  const reduxData = useSelector((state) => state);\r\n  console.log(reduxData);\r\n  console.log()\r\n\r\n  const classes = useStyle();\r\n\r\n  useEffect(() => {\r\n    // window.addEventListener(\"beforeunload\", alertUser);\r\n    window.addEventListener(\"unload\", handleEndConcert);\r\n    return () => {\r\n      // window.removeEventListener(\"beforeunload\", alertUser);\r\n      window.removeEventListener(\"unload\", handleEndConcert);\r\n      handleEndConcert();\r\n    };\r\n  }, []);\r\n  const alertUser = (e) => {\r\n     e.preventDefault();\r\n    const message =\r\n      \"Are you sure you want to leave? All provided data will be lost.\";\r\n    e.returnValue = message;\r\n    return message;\r\n  };\r\n\r\n  const handleEndConcert = async () => {\r\n    socket.emit(\"disconn\");\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (ananomMessages.data.length > 0) {\r\n      setMessages(ananomMessages.data);\r\n    }\r\n  }, [ananomMessages.data]);\r\n\r\n  useEffect(() => {\r\n    const saveConveration = async () => {\r\n      console.log(ananomMessages);\r\n      const res = await postDataAPI(\r\n        `create_ananomconversation`,\r\n        { messages },\r\n        auth.token\r\n      );\r\n      setRunSaveConversation(false);\r\n      setMessages([]);\r\n      dispatch(getMessages());\r\n      dispatch(getConversations({ auth }));\r\n      console.log(res);\r\n    };\r\n    \r\n    runSaveConversation &&  saveConveration();\r\n  }, [runSaveConversation])\r\n  \r\n\r\n  useEffect(() => {\r\n    console.log(socket);\r\n    socket.on(\"conn\", (data) => {\r\n      console.log(data);\r\n      setId(data.id);\r\n      setOwnId(data.ownId);\r\n      setGoogleId(data.googleId);\r\n      setWaitMessage(data.text);\r\n      // setMessages([]);\r\n      setCode(data.code);\r\n      setBcode(data.bcode);\r\n    });\r\n    socket.on(\"waiting\", (text) => {\r\n      setWaitMessage(text.text);\r\n      setCode(text.code);\r\n      setBcode(text.bcode);\r\n    });\r\n    socket.on(\"disconn\", (data) => {\r\n      // console.log(data.id);\r\n      // console.log(data.text);\r\n      setCode(data.code);\r\n      setBcode(data.bcode);\r\n      setWaitMessage(data.text);\r\n      if (messages.length > 0) {\r\n        setRunSaveConversation(true);\r\n      }\r\n      // console.log(code);\r\n    });\r\n  }, [ socket, end]);\r\n\r\n  //todo\r\n\r\n  // useEffect(() => {\r\n  //   if (!isAnanomUser) {\r\n  //     setEnd(true);\r\n  //   }\r\n  // }, [isAnanomUser]);\r\n\r\n  useEffect(() => {\r\n    if (end === true) {\r\n      socket.emit(\"disconn\");\r\n      setEnd(false);\r\n    }\r\n  }, [end, socket]);\r\n\r\n   useEffect(() => {\r\n     if (waitMessage === \"Stranger has left the chat\") {\r\n       if (messages.length > 0) {\r\n         setRunSaveConversation(true);\r\n       }\r\n     }\r\n   }, [waitMessage]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"istyping\", (isTyping) => {\r\n      setB(isTyping);\r\n    });\r\n  });\r\n\r\n  useEffect(() => {\r\n    socket.emit(\"typing\", typing);\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (find === true) {\r\n      console.log(\"trying to find\")\r\n      socket.emit(\"new\", auth.user.gender, auth.user._id);\r\n      setFind(false);\r\n    }\r\n  }, [find, socket]);\r\n\r\n  useEffect(() => {\r\n    toast(waitMessage);\r\n  }, [waitMessage])\r\n\r\n  // useEffect(() => {\r\n  //   const ananomId = \"6209378269425237042ee680\";\r\n  //   const useless = async () => {\r\n  //     const res = await getDataAPI(`user/${ananomId}`, auth.token);\r\n  //     console.log(res);\r\n  //   };\r\n  //   useless();\r\n  // }, []);\r\n\r\n  // useEffect(() => {\r\n  //   // console.log(auth.user.googleId);\r\n  //   // console.log(googleId);\r\n  //   if (auth.user._id != null && googleId != null && ownId != null) {\r\n  //     // console.log(ownId);\r\n  //     setAnanomConversation({\r\n  //       senderId: ownId,\r\n  //       receiverId: id,\r\n  //     });\r\n  //   }\r\n  // }, [auth.user._id, ownId, googleId, socket]);\r\n\r\n  return (\r\n    <Box className={classes.component}>\r\n      <ToastContainer />\r\n      {waitMessage === \"You are now chatting with a Stranger!\" ? (\r\n        <AnanomousUserChat\r\n          id={id}\r\n          ownId={ownId}\r\n          receiverId={id}\r\n          receiverSocketId={id}\r\n          receiverGoogleId={googleId}\r\n          waitMessage={waitMessage}\r\n          ananomConversation={ananomConversation}\r\n          find={find}\r\n          setFind={setFind}\r\n          end={end}\r\n          setEnd={setEnd}\r\n          bcode={bcode}\r\n          setBcode={setBcode}\r\n        ></AnanomousUserChat>\r\n      ) : (\r\n        <div className=\"message d-flex\">\r\n          <div className=\"col-md-12 px-0\">\r\n            <div className=\"d-flex justify-content-center align-items-center flex-column h-100\">\r\n              <i className=\"fa fa-bolt color-c1\" style={{ fontSize: \"5rem\" }} />\r\n              <h4>\r\n                <FindButton\r\n                  find={find}\r\n                  setFind={setFind}\r\n                  end={end}\r\n                  setEnd={setEnd}\r\n                  bcode={bcode}\r\n                  setBcode={setBcode}\r\n                />\r\n              </h4>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* {onEdit && (\r\n        <EndChatModel setOnEdit={setOnEdit} receiver={props.receiver} />\r\n      )} */}\r\n      {/* <div className=\"message d-flex\">\r\n        <div className=\"col-md-12 px-0\">\r\n          <div className=\"d-flex justify-content-center align-items-center flex-column h-100\">\r\n            <i className=\"fa fa-bolt color-c1\" style={{ fontSize: \"5rem\" }} />\r\n            <h4>\r\n              <FindButton\r\n                find={find}\r\n                setFind={setFind}\r\n                end={end}\r\n                setEnd={setEnd}\r\n                bcode={bcode}\r\n                setBcode={setBcode}\r\n              />\r\n            </h4>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <Box className={classes.container}>\r\n        <Stack sx={{ width: \"96%\", margin: \"3px auto 3px\" }}>\r\n          <Alert\r\n            severity={bcode === 1 ? \"success\" : \"info\"}\r\n            action={\r\n              <FindButton\r\n                find={find}\r\n                setFind={setFind}\r\n                end={end}\r\n                setEnd={setEnd}\r\n                bcode={bcode}\r\n                setBcode={setBcode}\r\n              />\r\n            }\r\n          >\r\n            <Typography className={classes.title}>{waitMessage}</Typography>\r\n          </Alert>\r\n        </Stack>\r\n        {waitMessage === \"You are now chatting with a Stranger!\" && (\r\n          <AnanomousUserChat\r\n            id={id}\r\n            ownId={ownId}\r\n            receiverId={id}\r\n            receiverGoogleId={googleId}\r\n            waitMessage={waitMessage}\r\n            ananomConversation={ananomConversation}\r\n          ></AnanomousUserChat>\r\n        )}\r\n\r\n        <Divider className={classes.divider} />\r\n      </Box> */}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default Ananommessage;\r\n"]},"metadata":{},"sourceType":"module"}