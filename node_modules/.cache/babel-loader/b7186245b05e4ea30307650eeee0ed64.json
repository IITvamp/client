{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from\"react\";// import UserCard from \"../UserCard\";\nimport AnanomUserCard from\"./AnanomUserCard\";import{useDispatch,useSelector}from\"react-redux\";// import { useParams } from \"react-router-dom\";\n// import { ToastContainer, toast } from \"react-toastify\";\nimport MsgDisplay from\"../message/MsgDisplay\";import AnanomMsgDisplay from\"./AnanomMsgDisplay\";import Icons from\"../Icons\";import{GLOBALTYPES}from\"../../redux/actions/globalTypes\";import{imageShow,videoShow}from\"../../utils/mediaShow\";import{imageUpload}from\"../../utils/imageUpload\";import EndChatModel from\"./EndChatModel\";import{addMessage}from\"../../redux/actions/saveConversation\";// import {\n//   addMessage,\n//   getMessages,\n//   MESSAGE_TYPES,\n// } from \"../../redux/actions/messageAction\";\nimport LoadIcon from\"../../images/loading.gif\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AnanomUserChat=function AnanomUserChat(props){console.log(props);var googleId=props.receiverGoogleId;var ananomConversation=props.ananomConversation;var receieverSocketID=props.receieverSocketID;var id=props.id;var ownID=props.ownId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,theme=_useSelector.theme,socket=_useSelector.socket;var dispatch=useDispatch();var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),incomingMessage=_useState6[0],setIncomingMessage=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),text=_useState8[0],setText=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),page=_useState10[0],setPage=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),onEdit=_useState12[0],setOnEdit=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),media=_useState14[0],setMedia=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),loadMedia=_useState16[0],setLoadMedia=_useState16[1];var refDisplay=useRef();var pageEnd=useRef();useEffect(function(){if(refDisplay.current){refDisplay.current.scrollIntoView({behaviour:\"smooth\",block:\"end\"});}},[]);useEffect(function(){socket.on(\"getAnanomMessage\",function(data){console.log(data);setIncomingMessage({sender:data.sender,receiverId:auth.user._id,text:data.text,media:data.media,createdAt:data.createdAt});});},[socket]);console.log(incomingMessage);useEffect(function(){var addmessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!incomingMessage){_context.next=4;break;}setMessages(function(prev){return[].concat(_toConsumableArray(prev),[incomingMessage]);});_context.next=4;return dispatch(addMessage({message:incomingMessage}));case 4:case\"end\":return _context.stop();}}},_callee);}));return function addmessage(){return _ref.apply(this,arguments);};}();addmessage();},[incomingMessage]);var handleChangeMedia=function handleChangeMedia(e){var files=_toConsumableArray(e.target.files);var err=\"\";var newMedia=[];files.forEach(function(file){if(!file){return err=\"File does not exist.\";}if(file.size>1024*1024*5){return err=\"Image size must be less than 5 mb.\";}return newMedia.push(file);});if(err){dispatch({type:GLOBALTYPES.ALERT,payload:{error:err}});}setMedia([].concat(_toConsumableArray(media),newMedia));};var handleDeleteMedia=function handleDeleteMedia(index){var newArr=_toConsumableArray(media);newArr.splice(index,1);setMedia(newArr);};var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var newArr,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!(!text.trim()&&media.length===0)){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:setText(\"\");setMedia([]);setLoadMedia(true);newArr=[];if(!(media.length>0)){_context2.next=11;break;}_context2.next=10;return imageUpload(media);case 10:newArr=_context2.sent;case 11:message={sender:auth.user._id,receiverId:googleId,text:text,media:newArr,createdAt:new Date().toISOString()};console.log(ananomConversation);console.log(ownID);// ananomConversation?.members?.includes(ownID) &&\nsetMessages(function(prev){return[].concat(_toConsumableArray(prev),[message]);});socket.emit(\"sendAnanomMessage\",message);setLoadMedia(false);_context2.next=19;return dispatch(addMessage({message:message}));case 19:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){if(refDisplay.current){refDisplay.current.scrollIntoView({behaviour:\"smooth\",block:\"end\"});}},[text,messages]);// useEffect(() => {\n//   if (incomingMessage) {\n//     refDisplay.current.scrollIntoView({\n//       behaviour: \"smooth\",\n//       block: \"end\",\n//     });\n//   }\n// }, [incomingMessage]);\nconsole.log(googleId);return/*#__PURE__*/_jsxs(_Fragment,{children:[console.log(\"tp check if working\"),/*#__PURE__*/_jsx(\"div\",{className:\"message_header\",children:/*#__PURE__*/_jsx(AnanomUserCard,{ananomId:googleId,find:props.find,setFind:props.setFind,end:props.end,setEnd:props.setEnd,bcode:props.bcode,setBcode:props.setBcode,receiver:googleId,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash text-danger\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat_container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat_display\",ref:refDisplay,children:[/*#__PURE__*/_jsx(\"button\",{style:{marginTop:\"-25px\",opacity:0},ref:pageEnd,children:\"Load..\"}),messages.map(function(msg,index){return/*#__PURE__*/_jsxs(\"div\",{children:[msg.sender!==auth.user._id&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row other_message\",children:/*#__PURE__*/_jsx(AnanomMsgDisplay,{msg:msg,theme:theme})}),msg.sender===auth.user._id&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row you_message\",children:/*#__PURE__*/_jsx(MsgDisplay,{user:auth.user,msg:msg,theme:theme})})]},index);}),loadMedia&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row you_message\",children:/*#__PURE__*/_jsx(\"img\",{src:LoadIcon,alt:\"Loading...\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"show_media\",style:{display:media.length>0?\"\":\"none\"},children:media.map(function(item,index){return/*#__PURE__*/_jsxs(\"div\",{id:\"file_media\",children:[item.type.match(/video/i)?videoShow(URL.createObjectURL(item),theme):imageShow(URL.createObjectURL(item),theme),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return handleDeleteMedia(index);},children:\"\\xD7\"})]},index);})}),/*#__PURE__*/_jsxs(\"form\",{className:\"chat_input\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Type a message.\",type:\"text\",value:text,onChange:function onChange(e){return setText(e.target.value);},style:{filter:theme?\"invert(1)\":\"invert(0)\",background:theme?\"#040404\":\"\",color:theme?\"white\":\"\"}}),/*#__PURE__*/_jsx(Icons,{setContent:setText,content:text,theme:theme}),/*#__PURE__*/_jsxs(\"div\",{className:\"file_upload\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-image color-c1\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"file\",id:\"file\",multiple:true,accept:\"image/*,video/*\",onChange:handleChangeMedia})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:text||media.length>0?false:true,className:\"material-icons\",children:\"near_me\"})]}),onEdit&&/*#__PURE__*/_jsx(EndChatModel,{setOnEdit:setOnEdit,receiver:props.receiver})]});};export default AnanomUserChat;","map":{"version":3,"sources":["C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/src/components/AnanomousUser/AnanomUserChat.js"],"names":["React","useEffect","useState","useRef","AnanomUserCard","useDispatch","useSelector","MsgDisplay","AnanomMsgDisplay","Icons","GLOBALTYPES","imageShow","videoShow","imageUpload","EndChatModel","addMessage","LoadIcon","AnanomUserChat","props","console","log","googleId","receiverGoogleId","ananomConversation","receieverSocketID","id","ownID","ownId","messages","setMessages","data","setData","state","auth","theme","socket","dispatch","incomingMessage","setIncomingMessage","text","setText","page","setPage","onEdit","setOnEdit","media","setMedia","loadMedia","setLoadMedia","refDisplay","pageEnd","current","scrollIntoView","behaviour","block","on","sender","receiverId","user","_id","createdAt","addmessage","prev","message","handleChangeMedia","e","files","target","err","newMedia","forEach","file","size","push","type","ALERT","payload","error","handleDeleteMedia","index","newArr","splice","handleSubmit","preventDefault","trim","length","Date","toISOString","emit","find","setFind","end","setEnd","bcode","setBcode","marginTop","opacity","map","msg","display","item","match","URL","createObjectURL","value","filter","background","color","receiver"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\n// import UserCard from \"../UserCard\";\r\nimport AnanomUserCard from \"./AnanomUserCard\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\n// import { useParams } from \"react-router-dom\";\r\n// import { ToastContainer, toast } from \"react-toastify\";\r\nimport MsgDisplay from \"../message/MsgDisplay\";\r\nimport AnanomMsgDisplay from \"./AnanomMsgDisplay\";\r\nimport Icons from \"../Icons\";\r\nimport { GLOBALTYPES } from \"../../redux/actions/globalTypes\";\r\nimport { imageShow, videoShow } from \"../../utils/mediaShow\";\r\nimport { imageUpload } from \"../../utils/imageUpload\";\r\nimport EndChatModel from \"./EndChatModel\";\r\nimport {\r\n  addMessage,\r\n} from \"../../redux/actions/saveConversation\";\r\n\r\n// import {\r\n//   addMessage,\r\n//   getMessages,\r\n//   MESSAGE_TYPES,\r\n// } from \"../../redux/actions/messageAction\";\r\nimport LoadIcon from \"../../images/loading.gif\";\r\n\r\nconst AnanomUserChat = (props) => {\r\n  console.log(props);\r\n  const googleId = props.receiverGoogleId;\r\n  const ananomConversation = props.ananomConversation;\r\n  const receieverSocketID = props.receieverSocketID;\r\n  const id = props.id;\r\n  const ownID = props.ownId;\r\n  const [messages, setMessages] = useState([]);\r\n      const [data, setData] = useState([]);\r\n  const { auth, theme, socket } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n  const [incomingMessage, setIncomingMessage] = useState(null);\r\n  const [text, setText] = useState(\"\");\r\n  const [page, setPage] = useState(0);\r\n  const [onEdit, setOnEdit] = useState(false);\r\n  const [media, setMedia] = useState([]);\r\n  const [loadMedia, setLoadMedia] = useState(false);\r\n\r\n  const refDisplay = useRef();\r\n  const pageEnd = useRef();\r\n\r\n  useEffect(() => {\r\n    if (refDisplay.current) {\r\n      refDisplay.current.scrollIntoView({ behaviour: \"smooth\", block: \"end\" });\r\n    }\r\n  }, []);\r\n  \r\n  useEffect(() => {\r\n    socket.on(\"getAnanomMessage\", (data) => {\r\n      console.log(data);\r\n      setIncomingMessage({\r\n        sender: data.sender,\r\n        receiverId: auth.user._id,\r\n        text: data.text,\r\n        media: data.media,\r\n        createdAt: data.createdAt,\r\n      });\r\n    });\r\n  }, [socket]);\r\n\r\n  console.log(incomingMessage);\r\n\r\n  useEffect(() => {\r\n    const addmessage = async () => {\r\n      if (incomingMessage) {\r\n        setMessages((prev) => [...prev, incomingMessage]);\r\n        await dispatch(addMessage({ message:incomingMessage }));\r\n      }\r\n    };\r\n    addmessage();\r\n  }, [incomingMessage]);\r\n\r\n  const handleChangeMedia = (e) => {\r\n    const files = [...e.target.files];\r\n    let err = \"\";\r\n    let newMedia = [];\r\n\r\n    files.forEach((file) => {\r\n      if (!file) {\r\n        return (err = \"File does not exist.\");\r\n      }\r\n      if (file.size > 1024 * 1024 * 5) {\r\n        return (err = \"Image size must be less than 5 mb.\");\r\n      }\r\n      return newMedia.push(file);\r\n    });\r\n    if (err) {\r\n      dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err } });\r\n    }\r\n    setMedia([...media, ...newMedia]);\r\n  };\r\n\r\n  const handleDeleteMedia = (index) => {\r\n    const newArr = [...media];\r\n    newArr.splice(index, 1);\r\n    setMedia(newArr);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!text.trim() && media.length === 0) return;\r\n    setText(\"\");\r\n    setMedia([]);\r\n\r\n    setLoadMedia(true);\r\n\r\n    let newArr = [];\r\n    if (media.length > 0) newArr = await imageUpload(media);\r\n\r\n    let message = {\r\n      sender: auth.user._id,\r\n      receiverId: googleId,\r\n      text,\r\n      media: newArr,\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n    console.log(ananomConversation);\r\n    console.log(ownID);\r\n    // ananomConversation?.members?.includes(ownID) &&\r\n    setMessages((prev) => [...prev, message]);\r\n    socket.emit(\"sendAnanomMessage\", message);\r\n    setLoadMedia(false);\r\n    await dispatch(addMessage({ message}));\r\n    // if (refDisplay.current) {\r\n    //   refDisplay.current.scrollIntoView({\r\n    //     behaviour: \"smooth\",\r\n    //     block: \"end\",\r\n    //   });\r\n    // }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (refDisplay.current) {\r\n      refDisplay.current.scrollIntoView({\r\n        behaviour: \"smooth\",\r\n        block: \"end\",\r\n      });\r\n    }\r\n  }, [text, messages]);\r\n\r\n  // useEffect(() => {\r\n  //   if (incomingMessage) {\r\n  //     refDisplay.current.scrollIntoView({\r\n  //       behaviour: \"smooth\",\r\n  //       block: \"end\",\r\n  //     });\r\n  //   }\r\n  // }, [incomingMessage]);\r\n\r\n  console.log(googleId);\r\n  return (\r\n    <>\r\n      {console.log(\"tp check if working\")}\r\n      <div className=\"message_header\">\r\n        <AnanomUserCard\r\n          ananomId={googleId}\r\n          find={props.find}\r\n          setFind={props.setFind}\r\n          end={props.end}\r\n          setEnd={props.setEnd}\r\n          bcode={props.bcode}\r\n          setBcode={props.setBcode}\r\n          receiver={googleId}\r\n        >\r\n          <i className=\"fas fa-trash text-danger\" />\r\n        </AnanomUserCard>\r\n      </div>\r\n\r\n      <div\r\n        className=\"chat_container\"\r\n      >\r\n        <div className=\"chat_display\" ref={refDisplay}>\r\n          <button style={{ marginTop: \"-25px\", opacity: 0 }} ref={pageEnd}>\r\n            Load..\r\n          </button>\r\n\r\n          {messages.map((msg, index) => (\r\n            <div key={index}>\r\n              {msg.sender !== auth.user._id && (\r\n                <div className=\"chat_row other_message\">\r\n                  <AnanomMsgDisplay msg={msg} theme={theme} />\r\n                </div>\r\n              )}\r\n              {msg.sender === auth.user._id && (\r\n                <div className=\"chat_row you_message\">\r\n                  <MsgDisplay user={auth.user} msg={msg} theme={theme} />\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))}\r\n          {loadMedia && (\r\n            <div className=\"chat_row you_message\">\r\n              <img src={LoadIcon} alt=\"Loading...\" />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div\r\n        className=\"show_media\"\r\n        style={{ display: media.length > 0 ? \"\" : \"none\" }}\r\n      >\r\n        {media.map((item, index) => (\r\n          <div key={index} id=\"file_media\">\r\n            {item.type.match(/video/i)\r\n              ? videoShow(URL.createObjectURL(item), theme)\r\n              : imageShow(URL.createObjectURL(item), theme)}\r\n            <span onClick={() => handleDeleteMedia(index)}>&times;</span>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <form className=\"chat_input\" onSubmit={handleSubmit}>\r\n        <input\r\n          placeholder=\"Type a message.\"\r\n          type=\"text\"\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          style={{\r\n            filter: theme ? \"invert(1)\" : \"invert(0)\",\r\n            background: theme ? \"#040404\" : \"\",\r\n            color: theme ? \"white\" : \"\",\r\n          }}\r\n        />\r\n        <Icons setContent={setText} content={text} theme={theme} />\r\n        <div className=\"file_upload\">\r\n          <i className=\"fas fa-image color-c1\" />\r\n          <input\r\n            type=\"file\"\r\n            name=\"file\"\r\n            id=\"file\"\r\n            multiple\r\n            accept=\"image/*,video/*\"\r\n            onChange={handleChangeMedia}\r\n          />\r\n        </div>\r\n        <button\r\n          type=\"submit\"\r\n          disabled={text || media.length > 0 ? false : true}\r\n          className=\"material-icons\"\r\n        >\r\n          near_me\r\n        </button>\r\n      </form>\r\n\r\n      {onEdit && (\r\n        <EndChatModel setOnEdit={setOnEdit} receiver={props.receiver} />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AnanomUserChat;\r\n"]},"metadata":{},"sourceType":"module"}