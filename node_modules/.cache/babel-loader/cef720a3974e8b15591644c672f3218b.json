{"ast":null,"code":"import _toConsumableArray from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{GLOBALTYPES}from\"./globalTypes\";import{postDataAPI,getDataAPI}from\"../../utils/fetchData\";import{createNotify,removeNotify}from\"./notifyAction\";export var REQUEST_TYPES={LOADING:\"LOADING_REQUESTS\",CREATE_REQUEST:\"CREATE_REQUEST\",ACCEPT_REQUEST:\"ACCEPT_REQUEST\",REJECT_REQUEST:\"REJECT_REQUEST\",GET_SENT_REQUESTS:\"GET_SENT_REQUESTS\",GET_RECEIVED_REQUESTS:\"GET_RECEIVED_REQUESTS\",GET_MATCH_REQUEST:\"GET_MATCH_REQUEST\"};export var createRequest=function createRequest(_ref){var sender=_ref.sender,receiver=_ref.receiver,user=_ref.user,auth=_ref.auth,socket=_ref.socket;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!user.matches.every(function(item){return item._id!==receiver;})){_context.next=11;break;}_context.prev=1;_context.next=4;return postDataAPI(\"createrequest\",{sender:sender,receiver:receiver},auth.token);case 4:dispatch({type:REQUEST_TYPES.CREATE_REQUEST});socket.emit(\"requestmatch\",sender);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context.t0.response.data.msg}});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function(_x){return _ref2.apply(this,arguments);};}();};export var getSentMatchRequests=function getSentMatchRequests(_ref3){var auth=_ref3.auth,_ref3$page=_ref3.page,page=_ref3$page===void 0?1:_ref3$page;return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var res,newArr;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return getDataAPI(\"sentrequests?limit=\".concat(page*9),auth.token);case 3:res=_context2.sent;newArr=res.data.matchRequests;dispatch({type:REQUEST_TYPES.GET_SENT_REQUESTS,payload:{newArr:newArr,result:res.data.result}});_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context2.t0.response.data.msg}});case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function(_x2){return _ref4.apply(this,arguments);};}();};export var getReceivedMatchRequests=function getReceivedMatchRequests(_ref5){var auth=_ref5.auth;return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var res,newArr;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return getDataAPI(\"receivedrequests\",auth.token);case 3:res=_context3.sent;newArr=res.data.matchRequests;dispatch({type:REQUEST_TYPES.GET_RECEIVED_REQUESTS,payload:{newArr:newArr,result:res.data.result}});_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context3.t0.response.data.msg}});case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function(_x3){return _ref6.apply(this,arguments);};}();};export var acceptMatchRequest=function acceptMatchRequest(_ref7){var users=_ref7.users,user=_ref7.user,auth=_ref7.auth,socket=_ref7.socket,id=_ref7.id;return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var newUser,res,msg;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(users.every(function(item){return item._id!==user._id;})){newUser=_objectSpread(_objectSpread({},user),{},{matches:[].concat(_toConsumableArray(user.matches),[auth.user])});}else{users.forEach(function(item){if(item._id===user._id){newUser=_objectSpread(_objectSpread({},item),{},{matches:[].concat(_toConsumableArray(item.matches),[auth.user])});}});}dispatch({type:REQUEST_TYPES.ACCEPT_REQUEST,payload:newUser});dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:_objectSpread(_objectSpread({},auth.user),{},{matches:[].concat(_toConsumableArray(auth.user.matches),[newUser])})})});_context4.prev=3;_context4.next=6;return postDataAPI(\"/acceptrequest\",{id:id},auth.token);case 6:res=_context4.sent;// todo socket\nsocket.emit(\"makematch\",newUser);// todo notification\nmsg={id:auth.user._id,text:\"is now a match with you\",recipients:[newUser._id],url:\"/profile/\".concat(auth.user._id)};dispatch(createNotify({msg:msg,auth:auth,socket:socket}));_context4.next=15;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](3);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context4.t0.response.data.msg}});case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[3,12]]);}));return function(_x4){return _ref8.apply(this,arguments);};}();};export var rejectMatchRequest=function rejectMatchRequest(_ref9){var id=_ref9.id,auth=_ref9.auth,socket=_ref9.socket;return/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch){var res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return postDataAPI(\"/rejectrequest\",{id:id},auth.token);case 3:res=_context5.sent;_context5.next=9;break;case 6:_context5.prev=6;_context5.t0=_context5[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context5.t0.response.data.msg}});case 9:case\"end\":return _context5.stop();}}},_callee5,null,[[0,6]]);}));return function(_x5){return _ref10.apply(this,arguments);};}();};","map":{"version":3,"sources":["C:/Users/ayush/Desktop/myProjects/mern-social-media-master/client/src/redux/actions/matchRequestAction.js"],"names":["GLOBALTYPES","postDataAPI","getDataAPI","createNotify","removeNotify","REQUEST_TYPES","LOADING","CREATE_REQUEST","ACCEPT_REQUEST","REJECT_REQUEST","GET_SENT_REQUESTS","GET_RECEIVED_REQUESTS","GET_MATCH_REQUEST","createRequest","sender","receiver","user","auth","socket","dispatch","matches","every","item","_id","token","type","emit","ALERT","payload","error","response","data","msg","getSentMatchRequests","page","res","newArr","matchRequests","result","getReceivedMatchRequests","acceptMatchRequest","users","id","newUser","forEach","AUTH","text","recipients","url","rejectMatchRequest"],"mappings":"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","sourcesContent":["import { GLOBALTYPES } from \"./globalTypes\";\r\nimport { postDataAPI, getDataAPI } from \"../../utils/fetchData\";\r\nimport { createNotify, removeNotify } from \"./notifyAction\";\r\n\r\nexport const REQUEST_TYPES = {\r\n  LOADING: \"LOADING_REQUESTS\",\r\n  CREATE_REQUEST: \"CREATE_REQUEST\",\r\n  ACCEPT_REQUEST: \"ACCEPT_REQUEST\",\r\n  REJECT_REQUEST: \"REJECT_REQUEST\",\r\n  GET_SENT_REQUESTS: \"GET_SENT_REQUESTS\",\r\n  GET_RECEIVED_REQUESTS: \"GET_RECEIVED_REQUESTS\",\r\n  GET_MATCH_REQUEST: \"GET_MATCH_REQUEST\",\r\n};\r\n\r\nexport const createRequest =\r\n  ({ sender, receiver, user, auth, socket }) =>\r\n  async (dispatch) => {\r\n    if (user.matches.every((item) => item._id !== receiver)) {\r\n      try {\r\n          await postDataAPI(\"createrequest\", { sender, receiver }, auth.token);\r\n          dispatch({\r\n            type: REQUEST_TYPES.CREATE_REQUEST,\r\n          });\r\n          socket.emit(\"requestmatch\", sender);\r\n      } catch (err) {\r\n        dispatch({\r\n          type: GLOBALTYPES.ALERT,\r\n          payload: { error: err.response.data.msg },\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\nexport const getSentMatchRequests =\r\n  ({ auth, page = 1 }) =>\r\n  async (dispatch) => {\r\n    try {\r\n      const res = await getDataAPI(\r\n        `sentrequests?limit=${page * 9}`,\r\n        auth.token\r\n      );\r\n      let newArr = res.data.matchRequests;\r\n      dispatch({\r\n        type: REQUEST_TYPES.GET_SENT_REQUESTS,\r\n        payload: { newArr, result: res.data.result },\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n\r\nexport const getReceivedMatchRequests =\r\n  ({ auth}) =>\r\n  async (dispatch) => {\r\n    try {\r\n      const res = await getDataAPI(\r\n        `receivedrequests`,\r\n        auth.token\r\n      );\r\n      let newArr = res.data.matchRequests;\r\n      dispatch({\r\n        type: REQUEST_TYPES.GET_RECEIVED_REQUESTS,\r\n        payload: { newArr, result: res.data.result },\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n\r\nexport const acceptMatchRequest =\r\n  ({ users, user, auth, socket, id }) =>\r\n  async (dispatch) => {\r\n    let newUser;\r\n    if (users.every((item) => item._id !== user._id)) {\r\n      newUser = { ...user, matches: [...user.matches, auth.user] };\r\n    } else {\r\n      users.forEach((item) => {\r\n        if (item._id === user._id) {\r\n          newUser = { ...item, matches: [...item.matches, auth.user] };\r\n        }\r\n      });\r\n    }\r\n\r\n    dispatch({ type: REQUEST_TYPES.ACCEPT_REQUEST, payload: newUser });\r\n\r\n    dispatch({\r\n      type: GLOBALTYPES.AUTH,\r\n      payload: {\r\n        ...auth,\r\n        user: { ...auth.user, matches: [...auth.user.matches, newUser] },\r\n      },\r\n    });\r\n\r\n    try {\r\n      const res = await postDataAPI(\r\n        `/acceptrequest`,\r\n        {id},\r\n        auth.token\r\n      );\r\n      // todo socket\r\n      socket.emit(\"makematch\", newUser);\r\n\r\n      // todo notification\r\n      const msg = {\r\n        id: auth.user._id,\r\n        text: \"is now a match with you\",\r\n        recipients: [newUser._id],\r\n        url: `/profile/${auth.user._id}`,\r\n      };\r\n\r\n      dispatch(createNotify({ msg, auth, socket }));\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n\r\nexport const rejectMatchRequest =\r\n  ({ id, auth, socket }) =>\r\n  async (dispatch) => {\r\n    try {\r\n      const res = await postDataAPI(`/rejectrequest`, { id }, auth.token);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };"]},"metadata":{},"sourceType":"module"}